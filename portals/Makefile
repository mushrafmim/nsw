.PHONY: help setup install clean dev-oga dev-trader dev-all build build-oga build-trader build-ui lint lint-fix test preview-oga preview-trader

# Default target
help:
	@echo "ğŸ“¦ NSW Portals - Development Commands"
	@echo ""
	@echo "Setup & Installation:"
	@echo "  make setup          - Install pnpm globally and setup workspace"
	@echo "  make install        - Install all dependencies"
	@echo "  make clean          - Remove node_modules and lock files"
	@echo ""
	@echo "Development:"
	@echo "  make dev-oga        - Run OGA app in dev mode"
	@echo "  make dev-trader     - Run Trader app in dev mode"
	@echo "  make dev-all        - Run all apps concurrently"
	@echo ""
	@echo "Build:"
	@echo "  make build          - Build all workspaces"
	@echo "  make build-oga      - Build OGA app only"
	@echo "  make build-trader   - Build Trader app only"
	@echo "  make build-ui       - Build UI library only"
	@echo ""
	@echo "Quality:"
	@echo "  make lint           - Run ESLint on all workspaces"
	@echo "  make lint-fix       - Run ESLint with --fix"
	@echo ""

# Setup pnpm if not installed
setup:
	@echo "ğŸ”§ Setting up development environment..."
	@command -v pnpm >/dev/null 2>&1 || { \
		echo "ğŸ“¥ Installing pnpm globally..."; \
		npm install -g pnpm@10.28.1; \
	}
	@echo "âœ… pnpm is installed"
	@$(MAKE) install
	@echo "âœ… Setup complete!"

# Install dependencies
install:
	@echo "ğŸ“¦ Installing dependencies with pnpm..."
	@pnpm install

# Clean all node_modules and lock files
clean:
	@echo "ğŸ§¹ Cleaning workspace..."
	@rm -rf node_modules
	@rm -rf apps/*/node_modules
	@rm -rf ui/node_modules
	@rm -rf ui/dist apps/*/dist
	@rm -rf apps/*/.turbo
	@echo "âœ… Cleaned!"

# Development servers
dev-oga:
	@echo "ğŸš€ Starting OGA app..."
	@pnpm --filter oga-app dev

dev-trader:
	@echo "ğŸš€ Starting Trader app..."
	@pnpm --filter trader-app dev

dev-all:
	@echo "ğŸš€ Starting all apps concurrently..."
	@pnpm --parallel --filter "./apps/*" dev

# Build commands
build:
	@echo "ğŸ—ï¸  Building all workspaces..."
	@pnpm -r build

build-oga:
	@echo "ğŸ—ï¸  Building OGA app..."
	@pnpm --filter oga-app build

build-trader:
	@echo "ğŸ—ï¸  Building Trader app..."
	@pnpm --filter trader-app build

build-ui:
	@echo "ğŸ—ï¸  Building UI library..."
	@pnpm --filter @lsf/ui build

# Linting
lint:
	@echo "ğŸ” Running ESLint..."
	@pnpm -r lint

lint-fix:
	@echo "ğŸ”§ Running ESLint with --fix..."
	@pnpm -r exec eslint . --fix

# Preview production builds
preview-oga:
	@echo "ğŸ‘€ Previewing OGA app..."
	@pnpm --filter oga-app preview

preview-trader:
	@echo "ğŸ‘€ Previewing Trader app..."
	@pnpm --filter trader-app preview
